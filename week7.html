<!DOCTYPE html>

    <head>
        <metacharset="UTF-8">
            <title>Vue.js Pet Depot</title>
            <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
            <script src="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"></script>
            <script src="products.js"></script>
            <link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"></link>
            <link rel="manifest" href="petstore1.webmanifest">
            <style>
                .product {
                    border: 1px grey solid;
                    padding: 20px;
                    margin:20px;
                    text-align:center;
                }
            </style>
    </head>

    <body>
        <div id="app">
            <header>
                <h1 v-text ="sitename"></h1>
                <button v-on:click="showCheckout">
                    Check Out
                </button>
                <hr>
            </header>
            <main>
                <div v-if = "showProduct">
                    <div class = "product" v-for="product in sortedProducts">
                        <h2 v-text="product.title"></h2>
                        <h2 v-html="product.description"></h2>
                        <img v-bind:src="product.img" style="width: 250px; height: 250px;"></img>
                        <h2>Price: {{ product.price }}</h2>
                        <p>Stock: {{product.availableInventory - cartCount(product.id)}}</p>
                        
                        <button v-on:click='addtoCart(product)' v-if = "canAddToCart(product)">
                            Add to cart 
                            <span class="fas fa-cart-plus"></span>
                        </button> 

                        <button disabled = 'disabled' v-else>
                           Add to cart 
                            <span class="fas fa-cart-plus"></span>
                        </button>

                        <span v-if="product.availableInventory === cartCount(product.id)">
                            All Out!
                        </span>

                        <span v-else-if="product.availableInventory - cartCount(product.id) < 5">
                            Only {{product.availableInventory - cartCount(product.id)}} left!
                        </span>

                        <span v-else><strong>Buy now! Available now!</strong></span>
                        <div style ="height:10px"></div>
                        <div>
                            <span v-for = 'n in product.rating'><i class="fas fa-star"></i></span>
                            <span v-for = 'n in 5-product.rating'><i class="far fa-star"></i></span>
                        </div>
                        <hr>
                    </div>
                </div>

                <div v-else>
                    <h2>Checkout</h2>
                    <p>
                        <strong>First Name:</strong>
                        <!-- This inpute field is bound to 'firstName' in the 'order' object -->
                        <input v-model.trim = "order.firstName">
                        <!-- .trim is to remove the blank space from the left or right of the string -->
                    </p>
                    <p>
                        <strong>Last Name:</strong>
                        <input v-model.trim="order.lastName">
                    </p>
                    
                    <p><strong>Address:</strong><input v-model="order.address"></p>
                    <p><strong>City:</strong><input v-model="order.city"></p>
                    <p>
                        <strong>State:</strong>
                        <select v-model="order.state">
                            <!-- <option disabled value="">State</option> -->
                            <!-- <option>AL</option>
                            <option>AR</option>
                            <option>CA</option>
                            <option>NV</option> -->

                            <!-- <option v-bind:value="state.AL">AL</option>
                            <option v-bind:value="state.AR">AR</option>
                            <option v-bind:value="state.CA">CA</option>
                            <option v-bind:value="state.NV">NV</option> -->

                            <option disabled value = "">State</option>
                            <option v-for = "(state,key) in state" v-bind:value="state">
                                {{key}}
                            </option>
                        </select>
                    </p>
                    <p><strong>Zip/postal code:</strong><input v-model.number="order.zip"></p> <!-- to convert to int, use .number -->

                    <p>
                        <input type="checkbox" id="gift"
                        value="true"
                        v-model="order.gift"
                        v-bind:true-value="order.sendGift"
                        v-bind:false-value="order.dontSendGift"
                        >
                        <label for = "gift">Ship as Gift?</label>
                    </p>
                    <p>
                        <input type="radio" id="home" value="Home" v-model="order.method">
                        <label for = "home">Home</label>
                        <input type="radio" id="business" value="Business" v-model="order.method">
                        <label for="business">Business</label>
                    </p>

                    <h2>Order information</h2>
                    <p>First Name: {{order.firstName}}</p>
                    <p>Last Name: {{order.LastName}}</p>
                    <p>address: {{order.address}}</p>
                    <p>State: {{order.state}}</p>
                    <p>City: {{order.city}}</p>
                    <p>Zip: {{order.zip}}</p>
                    <p>Gift: {{order.gift}}</p>
                    <p>Home: {{order.home}}</p>
                    <p>Business: {{order.business}}</p>

                    <button v-on:click="submitForm">Place Order</button>
                </div>
            </main>
        </div>
        
        <script>
            let webstore =  new Vue({
                el: "#app",
                data: {
                    sitename:"Vue.js Pet Depot",
                    products:products,
                    // product: {
                    //     id: 1001,
                    //     title: "Pet rat",
                    //     description:'<em>My</em> rat live in my basement'+' rent free',
                    //     price:'3DHS',
                    //     img:'https://www.catster.com/wp-content/uploads/2015/06/cat-food-bowl-shutterstock_157112807_0.jpg',
                    //     stock: 5,
                    //     availableInventory: 5,
                    //     rating: 3,
                    // },
                    order: {
                        firstName: "",
                        lastName: "",
                        address: "",
                        vity: "",
                        state: "",
                        zip: "",
                        gift: " ",
                        method: "Home",
                        business: "",
                        sendGift: "Send as a gift",
                        dontSendGift: "Do not send as a gift",
                    },
                    state:{
                        AL: " ",
                        AR: " ",
                        CA: " ",
                        NV: " ",
                    },
                cart: [], //array to store items in the shopping cart
                showProduct: true
            },

            methods: {
                addtoCart(product) {
                    this.cart.push(product.id);
                },
                showCheckout() {
                    this.showProduct = this.showProduct ? false : true;
                },
                submitForm() {
                    alert("order submitted!")
                },
                canAddToCart: function (product) {
                    return product.availableInventory > this.cartCount(product.id);
                },
                cartCount(id) {
                    let count = 0;
                    for (let i = 0; i < this.cart.length; i++) {
                        if (this.cart[i] === id) {
                            count++;

                        }

                    }
                    return count;
                },
            },

            computed:{
                sortedProducts(){
                    let productsArray = this.products.slice(0);
                    function compare(a,b){
                        if (a.price>b.price){
                            return 1
                        }
                        if (a.price<b.price){
                            return -1
                        }
                        return 0
                    }
                    return productsArray.sort(compare)
                }
                // cartCount(){
                //     return this.cart.length ||'';
                // },
               
            },

            })       
        </script>
    </body>

    </html>